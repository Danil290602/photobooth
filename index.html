<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>LumaBooth Web Edition</title>
    <style>
        /* Global Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            -khtml-user-select: none;
            -moz-user-select: none;
            -ms-user-select: none;
            user-select: none;
        }

        body {
            background: linear-gradient(135deg, #007bff, #ffffff);
            color: #333;
            overflow: hidden;
            width: 100vw;
            height: 100vh;
            -webkit-overflow-scrolling: touch;
        }

        #app {
            width: 100vw;
            height: 100vh;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            position: relative;
            transition: all 0.5s ease;
        }

        /* Idle Screen */
        #idle-screen {
            text-align: center;
            background: rgba(255, 255, 255, 0.9);
            padding: 40px;
            border-radius: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            animation: fadeIn 1s;
            cursor: pointer;
        }

        #logo {
            max-width: 200px;
            margin-bottom: 20px;
        }

        .animation {
            font-size: 100px;
            animation: rotate 3s infinite linear;
        }

        @keyframes rotate {
            from { transform: rotate(0deg); }
            to { transform: rotate(360deg); }
        }

        .small-btn {
            position: absolute;
            bottom: 20px;
            right: 20px;
            padding: 10px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
        }

        /* Setup Screen */
        #setup-screen {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            text-align: center;
            animation: slideIn 0.5s;
        }

        select, button {
            margin: 10px;
            padding: 15px 30px;
            font-size: 18px;
            border: none;
            border-radius: 8px;
            background: #007bff;
            color: white;
            cursor: pointer;
            transition: background 0.3s;
            -webkit-appearance: none;
            appearance: none;
        }

        button:hover, button:active {
            background: #0056b3;
        }

        #frame-options {
            display: flex;
            justify-content: center;
            gap: 15px;
            flex-wrap: wrap;
        }

        #frame-options img {
            width: 100px;
            height: 75px;
            object-fit: cover;
            border: 2px solid #ccc;
            border-radius: 5px;
            cursor: pointer;
            transition: border 0.3s;
        }

        #frame-options img:hover, #frame-options img:active {
            border-color: #007bff;
        }

        /* Camera Screen */
        #camera-screen {
            position: relative;
            width: 100%;
            height: 100%;
            animation: fadeIn 0.5s;
        }

        #video, #canvas {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        #countdown {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            font-size: 200px;
            color: white;
            text-shadow: 0 0 20px black;
            animation: pulse 1s infinite;
        }

        #controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 20px;
        }

        #frame-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-size: cover;
            cursor: move;
            pointer-events: none; /* Default none, diaktifkan saat dragging */
        }

        /* Preview Screen */
        #preview-screen {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            text-align: center;
            animation: slideIn 0.5s;
        }

        #photo-layout {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        #photo-layout.strip {
            flex-direction: row;
        }

        #photo-layout.grid {
            flex-direction: row;
            flex-wrap: wrap;
            max-width: 600px;
        }

        #photo-layout.grid img {
            width: calc(50% - 5px);
        }

        #photo-layout img {
            width: 200px;
            height: 150px;
            object-fit: cover;
            border: 2px solid #ccc;
            border-radius: 5px;
        }

        #actions {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }

        /* Gallery Screen */
        #gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            max-height: 70vh;
            overflow-y: auto;
        }

        #gallery img {
            width: 100%;
            height: auto;
            cursor: pointer;
            border-radius: 5px;
        }

        /* Operator Mode */
        #operator-mode {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            text-align: center;
            animation: slideIn 0.5s;
        }

        /* Edit Modal */
        .modal {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.3);
            z-index: 1000;
        }

        /* Animations */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        @keyframes slideIn {
            from { transform: translateY(-50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.1); }
        }

        /* Hidden Class */
        .hidden {
            display: none !important;
        }

        /* Responsive */
        @media (max-width: 768px) {
            #countdown {
                font-size: 100px;
            }
            button {
                padding: 10px 20px;
                font-size: 16px;
            }
            #photo-layout img {
                width: 150px;
                height: 112px;
            }
        }
    </style>
</head>
<body>
    <div id="app">
        <!-- Idle Screen -->
        <div id="idle-screen">
            <img id="logo" src="assets/logo.png" alt="Logo" onerror="this.style.display='none';">
            <h1>Selamat Datang di LumaBooth!</h1>
            <p>Sentuh layar untuk memulai</p>
            <div class="animation">ðŸ“¸</div>
            <button id="operator-btn" class="small-btn">Operator</button>
        </div>

        <!-- Setup Screen -->
        <div id="setup-screen" class="hidden">
            <h2>Pilih Jumlah Foto</h2>
            <select id="photo-count">
                <option value="3">3 Foto</option>
                <option value="4">4 Foto</option>
            </select>
            <h2>Pilih Layout</h2>
            <select id="layout-select">
                <option value="strip">Strip 1x4</option>
                <option value="grid">Grid 2x2</option>
            </select>
            <h2>Pilih Frame</h2>
            <div id="frame-options"></div>
            <h2>Pilih Filter</h2>
            <select id="filter-select">
                <option value="none">Tidak Ada</option>
                <option value="grayscale">Hitam Putih</option>
                <option value="sepia">Vintage</option>
                <option value="hue-rotate(90deg)">Warna</option>
            </select>
            <button id="start-session">Mulai Sesi</button>
        </div>

        <!-- Camera Screen -->
        <div id="camera-screen" class="hidden">
            <video id="video" autoplay></video>
            <canvas id="canvas" class="hidden"></canvas>
            <div id="countdown" class="hidden">3</div>
            <div id="controls">
                <button id="mirror-toggle">Mirror: ON</button>
                <button id="start-photo">Ambil Foto</button>
                <button id="retake" class="hidden">Retake</button>
                <button id="edit-frame" class="hidden">Edit Frame</button>
            </div>
            <div id="frame-overlay"></div>
        </div>

        <!-- Preview Screen -->
        <div id="preview-screen" class="hidden">
            <div id="photo-layout"></div>
            <div id="actions">
                <button id="download">Download</button>
                <div id="qr-code"></div>
                <button id="share-whatsapp">Share WhatsApp</button>
                <button id="new-session">Sesi Baru</button>
            </div>
        </div>

        <!-- Gallery Screen -->
        <div id="gallery-screen" class="hidden">
            <h2>Galeri Foto</h2>
            <div id="gallery"></div>
            <button id="back-to-idle">Kembali</button>
        </div>

        <!-- Operator Mode -->
        <div id="operator-mode" class="hidden">
            <h2>Mode Operator</h2>
            <button id="view-gallery">Lihat Galeri</button>
            <button id="reset-gallery">Reset Galeri</button>
            <button id="change-logo">Ubah Logo</button>
            <button id="exit-operator">Keluar</button>
        </div>

        <!-- Edit Frame Modal -->
        <div id="edit-modal" class="hidden modal">
            <h3>Edit Frame</h3>
            <label>Warna: <input type="color" id="frame-color"></label>
            <button id="apply-edit">Terapkan</button>
            <button id="close-edit">Tutup</button>
        </div>
    </div>

    <script src="qrcode.min.js"></script>
    <script>
        // Global Variables
        let video = document.getElementById('video');
        let canvas = document.getElementById('canvas');
        let ctx = canvas.getContext('2d');
        let countdownEl = document.getElementById('countdown');
        let photoCount = 3;
        let currentPhoto = 0;
        let photos = [];
        let selectedFrame = '';
        let selectedFilter = 'none';
        let selectedLayout = 'strip';
        let mirror = true;
        let gallery = JSON.parse(localStorage.getItem('gallery')) || [];
        let frameColor = '#ffffff';

        // Audio
        let shutterSound = new Audio('assets/camera-shutter.mp3');
        let flashSound = new Audio('assets/flash.mp3');

        // Screens
        let idleScreen = document.getElementById('idle-screen');
        let setupScreen = document.getElementById('setup-screen');
        let cameraScreen = document.getElementById('camera-screen');
        let previewScreen = document.getElementById('preview-screen');
        let galleryScreen = document.getElementById('gallery-screen');
        let operatorMode = document.getElementById('operator-mode');
        let editModal = document.getElementById('edit-modal');

        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadFrames();
            idleScreen.addEventListener('click', showSetup);
            document.getElementById('operator-btn').addEventListener('click', showOperatorMode);
            document.getElementById('start-session').addEventListener('click', startSession);
            document.getElementById('start-photo').addEventListener('click', startPhoto);
            document.getElementById('retake').addEventListener('click', retake);
            document.getElementById('edit-frame').addEventListener('click', showEditModal);
            document.getElementById('download').addEventListener('click', downloadPhotos);
            document.getElementById('share-whatsapp').addEventListener('click', shareWhatsApp);
            document.getElementById('new-session').addEventListener('click', newSession);
            document.getElementById('view-gallery').addEventListener('click', showGallery);
            document.getElementById('reset-gallery').addEventListener('click', resetGallery);
            document.getElementById('change-logo').addEventListener('click', changeLogo);
            document.getElementById('back-to-idle').addEventListener('click', backToIdle);
            document.getElementById('exit-operator').addEventListener('click', backToIdle);
            document.getElementById('mirror-toggle').addEventListener('click', toggleMirror);
            document.getElementById('apply-edit').addEventListener('click', applyEdit);
            document.getElementById('close-edit').addEventListener('click', () => editModal.classList.add('hidden'));

            // Drag Frame Overlay (Mouse and Touch)
            const overlay = document.getElementById('frame-overlay');
            let isDragging = false;
            let offsetX, offsetY;

            function startDrag(e) {
                isDragging = true;
                overlay.style.pointerEvents = 'auto';
                const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                const clientY = e.touches ? e.touches[0].clientY : e.clientY;
                offsetX = clientX - overlay.offsetLeft;
                offsetY = clientY - overlay.offsetTop;
                e.preventDefault();
            }

            function drag(e) {
                if (!isDragging) return;
                const clientX = e.touches ? e.touches[0].clientX : e.clientX;
                const clientY = e.touches ? e.touches[0].clientY : e.clientY;
                overlay.style.left = (clientX - offsetX) + 'px';
                overlay.style.top = (clientY - offsetY) + 'px';
                e.preventDefault();
            }

            function endDrag() {
                isDragging = false;
                overlay.style.pointerEvents = 'none';
            }

            overlay.addEventListener('mousedown', startDrag);
            overlay.addEventListener('touchstart', startDrag, { passive: false });
            document.addEventListener('mousemove', drag);
            document.addEventListener('touchmove', drag, { passive: false });
            document.addEventListener('mouseup', endDrag);
            document.addEventListener('touchend', endDrag);

            // Fullscreen on load (opsional, hapus jika bermasalah di touchscreen)
            if (document.documentElement.requestFullscreen) {
                document.documentElement.requestFullscreen().catch(() => {});
            }
        });

        // Load Frames
        function loadFrames() {
            const frameOptions = document.getElementById('frame-options');
            const frames = ['frame1.png', 'frame2.png']; // Add more
            frames.forEach(frame => {
                const img = document.createElement('img');
                img.src = `frames/${frame}`;
                img.addEventListener('click', () => selectFrame(frame));
                frameOptions.appendChild(img);
            });
        }

        function selectFrame(frame) {
            selectedFrame = frame;
            document.getElementById('frame-overlay').style.backgroundImage = `url(frames/${frame})`;
            document.getElementById('edit-frame').classList.remove('hidden');
        }

        // Show Screens
        function showSetup() {
            idleScreen.classList.add('hidden');
            setupScreen.classList.remove('hidden');
        }

        function showCamera() {
            setupScreen.classList.add('hidden');
            cameraScreen.classList.remove('hidden');
            startCamera();
        }

        function showPreview() {
            cameraScreen.classList.add('hidden');
            previewScreen.classList.remove('hidden');
            displayPhotos();
            generateQR();
            setTimeout(backToIdle, 30000);
        }

        function showGallery() {
            operatorMode.classList.add('hidden');
            galleryScreen.classList.remove('hidden');
            displayGallery();
        }

        function showOperatorMode() {
            idleScreen.classList.add('hidden');
            operatorMode.classList.remove('hidden');
        }

        function backToIdle
